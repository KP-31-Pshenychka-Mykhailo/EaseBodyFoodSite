# Интеграция сердечек с сервером

## Обзор

Система сердечек теперь интегрирована с сервером для синхронизации избранных блюд между клиентом и сервером.

## Функциональность

### 1. Отправка запросов на сервер

При изменении состояния сердечка (добавление/удаление из избранного) автоматически отправляется запрос на сервер:

- **Добавление в избранное**: `POST /favorite/add`
- **Удаление из избранного**: `POST /favorite/remove`

### 2. Загрузка избранных блюд с сервера

При загрузке страницы система автоматически загружает избранные блюда с сервера:

- **Получение избранного**: `GET /favorite/get?userId={userId}`

### 3. Очистка избранного

При очистке избранного данные удаляются как локально, так и на сервере:

- **Очистка избранного**: `POST /favorite/clear`

## Структура запросов

### Добавление в избранное
```json
POST /favorite/add
{
  "UserId": 123,
  "DishId": "67"
}
```

### Удаление из избранного
```json
POST /favorite/remove
{
  "UserId": 123,
  "DishId": "67"
}
```

### Получение избранного
```
POST /favorite
{
  "userId": 123
}
```

### Очистка избранного
```json
POST /favorite/clear
{
  "UserId": 123
}
```

## Конфигурация

### Базовый URL сервера
Настройки сервера хранятся в `assets/data/settings.json`:
```json
{
  "SERVER_BASE_URL": "https://c383331ec9c0.ngrok-free.app"
}
```

### Получение UserId
Система получает userId из localStorage:
- `localStorage.getItem('userId')`

## Обработка ошибок

- Если пользователь не авторизован (userId не найден), запросы на сервер не отправляются
- Ошибки сети логируются в консоль, но не прерывают работу приложения
- Локальное состояние сохраняется независимо от успешности запросов на сервер

## Новые методы HeartsManager

### `sendHeartStateToServer(dishId, isActive)`
Отправляет запрос на сервер при изменении состояния сердечка.

### `loadFavoritesFromServer()`
Загружает избранные блюда с сервера и обновляет локальное состояние.

### `clearFavoritesOnServer()`
Очищает избранное на сервере.

### `getUserId()`
Получает userId пользователя из различных источников.

## Автоматическая синхронизация

1. **При загрузке страницы**: Загружаются избранные блюда с сервера
2. **При клике на сердечко**: Отправляется запрос на сервер
3. **При очистке избранного**: Данные удаляются с сервера

## Требования к серверу

Сервер должен поддерживать следующие endpoints:

- `POST /favorite/add` - добавление блюда в избранное
- `POST /favorite/remove` - удаление блюда из избранного  
- `POST /favorite` - получение списка избранных блюд
- `POST /favorite/clear` - очистка всего избранного

Все endpoints должны принимать и возвращать JSON данные. 