<header class="main-header">
    <img src="../EaseBodyFoodSite/assets/img/logo.png" alt="Logo" class="logo">
    <nav class="main-nav" id="mainNav">
        <a href="/EaseBodyFoodSite/index.html">Головна</a>
        <a href="/EaseBodyFoodSite/constructor.html">Конструктор меню</a>
        <a href="/EaseBodyFoodSite/calculator.html">Калькулятор раціону</a>
       <!-- <a href="/EaseBodyFoodSite/star.html">Зіркове меню</a> -->
        <a href="/EaseBodyFoodSite/standart.html">Стандартне меню</a>
    </nav>
    <div class="header-actions">
        <a href="/EaseBodyFoodSite/cart.html" class="icon-button basket-big"><svg class="icon-img basket-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6H21L20 14H7L6 6Z" stroke="#4CAF50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="9" cy="20" r="1" stroke="#4CAF50" stroke-width="2"/><circle cx="18" cy="20" r="1" stroke="#4CAF50" stroke-width="2"/><path d="M9 6V4C9 2.89543 9.89543 2 11 2H16C17.1046 2 18 2.89543 18 4V6" stroke="#4CAF50" stroke-width="2" stroke-linecap="round"/></svg> 0 <span class="currency">₴</span></a>
        <a href="#" class="icon-button icon-button--wide" id="loginBtn"><svg class="icon-img user-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="4" stroke="#fff" stroke-width="2"/><path d="M4 20C4 16.6863 7.13401 14 12 14C16.866 14 20 16.6863 20 20" stroke="#fff" stroke-width="2"/></svg>Вхід</a>
    </div>
    <button class="burger" id="burgerBtn" aria-label="Открыть меню">
      <span></span><span></span><span></span>
    </button>
</header>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const userName = localStorage.getItem('userName');
    const loginBtn = document.getElementById('loginBtn');
    if (userName) {
      if (loginBtn) {
        loginBtn.innerHTML = `<svg class="icon-img user-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="4" stroke="#fff" stroke-width="2"/><path d="M4 20C4 16.6863 7.13401 14 12 14C16.866 14 20 16.6863 20 20" stroke="#fff" stroke-width="2"/></svg>${userName}`;
        loginBtn.href = "#";
      }
    }
    if (loginBtn) {
      loginBtn.addEventListener('click', function(e) {
        e.preventDefault();
        if (localStorage.getItem('userName')) {
          window.location.href = '/EaseBodyFoodSite/profile.html';
        } else {
          showRegisterModal();
        }
      });
    }
    function showRegisterModal() {
      // Проверяем, нет ли уже модалки
      if (document.getElementById('registerModalOverlay')) return;
      // Создаем overlay
      const overlay = document.createElement('div');
      overlay.id = 'registerModalOverlay';
      overlay.style.position = 'fixed';
      overlay.style.top = 0;
      overlay.style.left = 0;
      overlay.style.width = '100vw';
      overlay.style.height = '100vh';
      overlay.style.background = 'rgba(0,0,0,0.3)';
      overlay.style.zIndex = 10000;
      overlay.style.display = 'flex';
      overlay.style.justifyContent = 'center';
      overlay.style.alignItems = 'center';
      overlay.style.backdropFilter = 'blur(6px)';
      overlay.innerHTML = window.registerModalHTML || '';
      document.body.appendChild(overlay);
      document.body.style.overflow = 'hidden';
      // Закрытие по крестику
      overlay.addEventListener('click', function(e) {
        if (e.target.classList.contains('auth-modal__close') || e.target === overlay) {
          overlay.remove();
          document.body.style.overflow = '';
        }
      });
      // Prevent click inside modal from closing
      const modal = overlay.querySelector('.auth-modal');
      if (modal) {
        modal.addEventListener('click', function(e) { e.stopPropagation(); });
      }
      // JS для формы регистрации
      const form = overlay.querySelector('#registerForm');
      if (form) {
        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          const data = {
            FirstName: form.FirstName.value,
            SecondName: form.SecondName.value,
            Email: form.Email.value,
            PhoneNumber: form.PhoneNumber.value,
            Password: form.Password.value
          };
          if (form.Password.value !== form.ConfirmPassword.value) {
            alert('Паролі не співпадають!');
            return;
          }
          try {
            const res = await fetch('/api/register', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            });
            if (res.ok) {
              const result = await res.json();
              if (result.id) {
                localStorage.setItem('userId', result.id);
              }
              const email = form.Email.value;
              const userName = email.split('@')[0];
              localStorage.setItem('userName', userName);
              alert('Реєстрація успішна!');
              overlay.remove();
              document.body.style.overflow = '';
              // Можно обновить header
              window.location.reload();
            } else {
              const err = await res.text();
              alert('Помилка: ' + err);
            }
          } catch (err) {
            alert('Помилка з’єднання з сервером');
          }
        });
      }
    }
    // Загружаем HTML модалки регистрации (один раз)
    if (!window.registerModalHTML) {
      fetch('/EaseBodyFoodSite/partials/register-modal.html').then(r => r.text()).then(html => { window.registerModalHTML = html; });
    }
  });
</script> 